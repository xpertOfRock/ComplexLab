<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head(${book.title})"></head>
<body>
<div class="container">
    <div th:replace="fragments/layout :: nav"></div>

    <div class="grid grid-2">
        <div class="card">
            <div class="actions" style="justify-content:space-between;">
                <div>
                    <h2 style="margin:0;" th:text="${book.title}">Title</h2>
                    <div class="muted" th:text="${book.author}">Author</div>
                </div>
                <div class="actions" th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
                    <a class="btn secondary" th:href="@{'/admin/books/' + ${book.id} + '/edit'}">Edit</a>
                    <form th:action="@{'/admin/books/' + ${book.id} + '/delete'}" method="post">
                        <button class="btn danger" type="submit">Delete</button>
                    </form>
                </div>
            </div>
            <hr/>
            <p th:if="${book.description}" th:text="${book.description}"></p>
            <p class="muted" th:if="${book.description == null or #strings.isEmpty(book.description)}">No description.</p>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">Comments</h3>

            <div th:if="${#authentication != null and #authentication.authenticated}">
                <form th:action="@{'/books/' + ${book.id} + '/comments'}" method="post" class="grid">
                    <textarea name="commentText" class="input" placeholder="Write a comment..." required></textarea>
                    <button class="btn" type="submit">Add comment</button>
                </form>
                <hr/>
            </div>

            <div class="muted" th:if="${#authentication == null or !#authentication.authenticated}">
                <a th:href="@{/auth/login}">Login</a> to add comments.
                <hr/>
            </div>

            <div class="list" th:if="${#lists.isEmpty(comments)}">
                <p class="muted">No comments yet.</p>
            </div>

            <div class="list" th:if="${!#lists.isEmpty(comments)}">
                <div class="card" th:each="c : ${comments}">
                    <div class="actions" style="justify-content:space-between;">
                        <div>
                            <strong th:text="${c.author.username}">author</strong>
                            <div class="muted" th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">date</div>
                        </div>
                    </div>
                    <p th:text="${c.text}"></p>
                </div>
            </div>
        </div>
    </div>

    <div style="margin-top:14px;">
        <a class="btn secondary" th:href="@{/}">Back</a>
    </div>
</div>
</body>
</html>
